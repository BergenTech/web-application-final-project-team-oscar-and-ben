{% extends "blank.html" %}
{% set active_page = "messages" %}
{% set active_material = 0 %}
{% block content %}
<!-- <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"> -->
<div class="d-flex fixed-top ml-3" style="margin-top:80px;z-index:100;">
    <a href="/appointment_overview?identification={{session.id}}" class="text-decoration-none text-reset remove" data-swup-animation="left" data-transition="true">
        <div class="d-flex justify-content-center align-items-center">
            <div class="rounded-circle border d-flex justify-content-center align-items-center" style="width: 50px; height: 50px;">
                <i class="bi bi-arrow-left"></i>
            </div>
        </div>
    </a>
</div>

<!-- <div id="wrapper"> -->
    <!-- Begin Page Content -->
    <div class="container-fluid px-0 px-md-2 mx-0 mx-md-2">
        
        <div class="d-block px-0 px-md-2 mx-0 mx-md-2" id="materials">
            <div class="flex-row d-flex justify-content-center px-0 px-md-2 mx-0 mx-md-2">
                <div class="col-12 col-md-10 col-lg-10">
                    <div class="card shadow mb-4">
                        <!-- Card Header -->
                        <div class="card-header d-flex justify-content-center">
                            <div class="h1 mb-0 header-text text-center font-weight-bold">
                                View Materials
                            </div>
                        </div>

                        <!-- Card Body -->
                        <div class="card-body">

                            


                            <div class="file-display">
                                {% if session.files %}
                                    {% for file in session.files %}
                                        <div class="file-page d-none" style="height: 57.5vh; overflow-y: auto;">
                                            {% if file.filename.endswith('.png') %}
                                            <!-- Display PNG Image -->
                                            <img src="{{ url_for('display_file', file_id=file.id) }}" alt="{{ file.filename }}" style="width: 100%; height: auto; border: 2px solid #000;">
                                            {% elif file.filename.endswith('.pdf') %}
                                            <!-- Display PDF Document -->
<!-- Display PDF Document -->
                                            <div class="embed-responsive embed-responsive-16by9">
                                                <embed src="{{ url_for('display_file', file_id=file.id) }}" type="application/pdf" class="embed-responsive-item" style="width: 100%; border: 2px solid #000;">
                                            </div>
                                            {% endif %}
                                        </div>
                                    {% endfor %}
                                {%else%}
                                <div style="height:57.5vh;overflow:scroll;">
                                    No files yet!
                                    {%if thiss.role == 0%}
                                    Waiting on student to upload files
                                    {%else%}
                                    Upload some files to get started!
                                    {%endif%}
                                </div>
                                {% endif %}
                            </div>
                            
                            
                        </div>

                        <!-- Card Footer -->
                        <div class="card-footer d-flex d align-items-center justify-content-between">
                            <div class="button-group pagination-controls">
                                <button class="btn btn-secondary p-1 prev-page"><<</button>
                                <span class="page-number btn btn-primary py-1">1</span>
                                <button class="btn btn-secondary p-1 next-page">>></button>
                            </div>
                            <button class="btn btn-primary ml-auto" data-toggle="modal" data-target="#fileUploadModal">+</button>
                        </div>
                        <div class="modal modal-lg fade" id="fileUploadModal" tabindex="-1" aria-labelledby="fileUploadModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="fileUploadModalLabel">Submit a File</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                        
                                        <form id="modalFileUploadForm" action="/material_upload/{{ session.id }}" method="post" enctype="multipart/form-data" class="d-flex justify-content-center">
                                            <style>
                                                img:hover{
                                                    opacity:.5;
                                                }
                                            </style>
                                            <label for="imageUpload" class="mb-3">
                                                <img src="/static/assets2/img/addFile.webp" id="image" alt="Admin" width="100%" height="auto" style="cursor: pointer">
                                            </label>
                                            <input type="file" class="form-control-file d-none" id="imageUpload" name="image" accept=".pdf, .png" required>
                                        </form>
                                        <script>
                                            document.getElementById('imageUpload').addEventListener('change', function(event) {
                                                var reader = new FileReader();
                                                var imageElement = document.getElementById('image');
                                                var file = document.getElementById('imageUpload').files[0];
                                                
                                                if (file) {
                                                    // Check if the uploaded file is a PDF
                                                    if (file.type === "application/pdf") {
                                                        console.log("s");  // Log "s" to the console for PDF files
                                                        imageElement.src = "/static/assets2/img/pdfUploaded.jpg";  // Change image src if it's a PDF
                                                    } else {
                                                        // Read and display the image if the uploaded file is an image
                                                        reader.onload = function(e) {
                                                            imageElement.src = e.target.result;
                                                        };
                                                        reader.readAsDataURL(file);
                                                    }
                                                }
                                            });
                                        </script>
                                        
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                        <button type="submit" class="btn btn-primary" form="modalFileUploadForm">Submit</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /.container-fluid -->
</div>
<!-- Add the modal below the footer -->



<script src="https://cdn.socket.io/4.6.0/socket.io.min.js" integrity="sha384-c79GN5VsunZvi+Q/WObgk2in0CbZsHnjEqvFxC5DxHn9lTfNce2WW6h2pH6u/kF+" crossorigin="anonymous"></script>

<script>
    let currentPage = 1;
    const pages = document.querySelectorAll('.file-page');
    const itemsPerPage = 1;

    function updatePaginationControls() {
        const totalPages = pages.length;
        document.querySelector('.page-number').innerText = currentPage;
        document.querySelector('.prev-page').disabled = currentPage === 1;
        document.querySelector('.next-page').disabled = currentPage >= totalPages;
    }

    function showPage(page) {
        pages.forEach((pageElement, index) => {
            if (index + 1 === page) {
                pageElement.classList.remove('d-none');
                pageElement.classList.add('d-block');
            } else {
                pageElement.classList.remove('d-block');
                pageElement.classList.add('d-none');
            }
        });
        updatePaginationControls();
    }

    document.querySelector('.prev-page').addEventListener('click', () => {
        if (currentPage > 1) {
            currentPage--;
            showPage(currentPage);
        }
    });

    document.querySelector('.next-page').addEventListener('click', () => {
        if (currentPage < pages.length) {
            currentPage++;
            showPage(currentPage);
        }
    });

    // Initialize with the first file being displayed, if files exist
    if (pages.length > 0) {
        showPage(1);  // Show the first page
    }
</script>


{% endblock %}
