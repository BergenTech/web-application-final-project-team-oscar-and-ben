{% extends "blank.html" %}
{% set active_page = "messages" %}
{% set active_material = 0 %}
{% block content %}
<!-- <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"> -->
<div class="d-flex fixed-top ml-3" style="margin-top:80px;z-index:0;">
    <a href="/appointment_overview?identification={{session.id}}" class="text-decoration-none text-reset remove" data-swup-animation="left" data-transition="true">
        <div class="d-flex justify-content-center align-items-center">
            <div class="rounded-circle border d-flex justify-content-center align-items-center" style="width: 50px; height: 50px;">
                <i class="bi bi-arrow-left"></i>
            </div>
        </div>
    </a>
</div>

<div id="wrapper">
    <!-- Begin Page Content -->
    <div class="container-fluid">
        
        <div class="d-block" id="materials">
            <div class="flex-row d-flex justify-content-center">
                <div class="col-10">
                    <div class="card shadow mb-4">
                        <!-- Card Header -->
                        <div class="card-header d-flex justify-content-center">
                            <div class="h1 mb-0 header-text text-center font-weight-bold">
                                {%if thiss.role == 0%}
                                Upload New Materials
                                {%else%}
                                View Appointment Materials
                                {%endif%}
                            </div>
                        </div>

                        <!-- Card Body -->
                        <div class="card-body">

                            <div class="upload-form">
                                <form action="/material_upload/{{ session.id }}" method="post" enctype="multipart/form-data" class="d-flex align-items-center w-100 px-5">
                                    <style>
                                        #formSubmit {
                                            height: auto;
                                            width: 20vw;
                                        }
                                        #image:hover {
                                            opacity: .5;
                                        }
                                    </style>
                                    <label for="material_upload" class="mb-3">
                                        <img src="https://static.vecteezy.com/system/resources/thumbnails/023/454/938/small/important-document-upload-logo-design-vector.jpg" id="image" alt="Admin" width="130vw" height="130vw" style="cursor: pointer;height: auto;width: 30vw;">
                                    </label>
                                    <input class="d-none" id="material_upload" name="material_upload" type="file" accept='.png, .pdf' required>
                                    <button class="btn btn-primary ml-auto rounded-pill" type='submit' id="formSubmit">
                                        <div class="h1 p-5">Submit</div>
                                    </button>
                                </form>
                            </div>
                            <script>
                                document.getElementById('material_upload').addEventListener('change', function(event) {
                                    var reader = new FileReader();
                                    reader.onload = function(e) {
                                        document.getElementById('image').src = e.target.result;
                                    };
                                    var file = document.getElementById('material_upload').files[0];
                                    if (file) {
                                        reader.readAsDataURL(file);
                                    }
                                });
                            </script>


                            <div class="file-display d-none">
                                {% if session.files %}
                                    {% for file in session.files %}
                                        <div class="file-page d-none" style="height: 57.5vh; overflow-y: auto;">
                                            {% if file.filename.endswith('.png') %}
                                            <!-- Display PNG Image -->
                                            <img src="{{ url_for('display_file', file_id=file.id) }}" alt="{{ file.filename }}" style="width: 100%; height: auto; border: 2px solid #000;">
                                            {% elif file.filename.endswith('.pdf') %}
                                            <!-- Display PDF Document -->
                                            <embed src="{{ url_for('display_file', file_id=file.id) }}" type="application/pdf" height="100%" style="width: 100%; border: 2px solid #000;">
                                            {% endif %}
                                        </div>
                                    {% endfor %}
                                {%else%}
                                <div style="height:57.5vh">
                                    Lorem, ipsum dolor sit amet consectetur adipisicing elit. Recusandae totam, cum ratione voluptatem, quibusdam quasi doloremque aut atque reiciendis adipisci esse consectetur error libero iste, tenetur expedita. Non, illum odit?
                                    Illo quas deleniti doloribus tenetur corrupti deserunt blanditiis illum corporis ad quis. Mollitia nobis perferendis impedit cum beatae dolor nulla alias reprehenderit distinctio veritatis natus quisquam debitis, blanditiis corrupti dicta?
                                    Culpa saepe fuga deserunt? Quam iure et expedita voluptatibus alias facilis dolore! Consequuntur beatae ducimus vel enim consequatur voluptatem error recusandae est. Laudantium iste qui delectus sapiente aliquam odit et?
                                    Laboriosam suscipit qui eius atque nam. Consequuntur quam aut doloremque quos ex commodi officiis praesentium? Beatae in veniam facilis odio et, nihil eos tempora mollitia totam accusamus repellendus numquam facere!
                                </div>
                                {% endif %}
                            </div>
                            
                            
                        </div>

                        <!-- Card Footer -->
                        <div class="card-footer d-flex align-items-center justify-content-center">
                            <button class="btn btn-primary mode-toggle mr-auto" data-mode="upload">Upload Materials</button>
                            <div class="button-group pagination-controls d-none">
                                <button class="btn btn-secondary p-1 prev-page"><<</button>
                                <span class="page-number btn btn-primary py-1">1</span>
                                <button class="btn btn-secondary p-1 next-page">>></button>
                            </div>
                            <button class="btn btn-secondary mode-toggle ml-auto" data-mode="view">View Uploads</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /.container-fluid -->
</div>

<script src="https://cdn.socket.io/4.6.0/socket.io.min.js" integrity="sha384-c79GN5VsunZvi+Q/WObgk2in0CbZsHnjEqvFxC5DxHn9lTfNce2WW6h2pH6u/kF+" crossorigin="anonymous"></script>

<script>
    let currentPage = 1;
    const pages = document.querySelectorAll('.file-page');
    const itemsPerPage = 1;

    function updatePaginationControls() {
        const totalPages = pages.length;
        document.querySelector('.page-number').innerText = currentPage;
        document.querySelector('.prev-page').disabled = currentPage === 1;
        document.querySelector('.next-page').disabled = currentPage >= totalPages;
    }

    function showPage(page) {
        pages.forEach((pageElement, index) => {
            if (index + 1 === page) {
                pageElement.classList.remove('d-none');
                pageElement.classList.add('d-block');
            } else {
                pageElement.classList.remove('d-block');
                pageElement.classList.add('d-none');
            }
        });
        updatePaginationControls();
    }

    document.querySelector('.prev-page').addEventListener('click', () => {
        if (currentPage > 1) {
            currentPage--;
            showPage(currentPage);
        }
    });

    document.querySelector('.next-page').addEventListener('click', () => {
        if (currentPage < pages.length) {
            currentPage++;
            showPage(currentPage);
        }
    });

    function modeChange(mode){
        if (mode === 'view') {
            document.querySelector('.pagination-controls').classList.remove('d-none');
            document.querySelector('.file-display').classList.remove('d-none');
            document.querySelector('.upload-form').classList.add('d-none');
            document.querySelector('.header-text').textContent = "View Materials";
            document.querySelector('.mode-toggle[data-mode="view"]').classList.replace('btn-secondary', 'btn-primary');
            document.querySelector('.mode-toggle[data-mode="upload"]').classList.replace('btn-primary', 'btn-secondary');
            showPage(currentPage);
        } else {
            document.querySelector('.pagination-controls').classList.add('d-none');
            document.querySelector('.file-display').classList.add('d-none');
            document.querySelector('.upload-form').classList.remove('d-none');
            document.querySelector('.header-text').textContent = "Upload New Materials";
            document.querySelector('.mode-toggle[data-mode="upload"]').classList.replace('btn-secondary', 'btn-primary');
            document.querySelector('.mode-toggle[data-mode="view"]').classList.replace('btn-primary', 'btn-secondary');
        }
    }

    document.querySelectorAll('.mode-toggle').forEach(button => {
        button.addEventListener('click', (e) => {
            const mode = e.target.getAttribute('data-mode');
            modeChange(mode)
        });
    });

    // Initialize in upload mode
    document.querySelector('.mode-toggle[data-mode="view"]').click();
    {%if thiss.role==1%}
    document.querySelector('.mode-toggle[data-mode="view"]').classList.add('d-none')
    document.querySelector('.mode-toggle[data-mode="upload"]').classList.add('d-none')
    {%endif%}
</script>

{% endblock %}
